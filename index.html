<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Sun Analysis App</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/suncalc/1.9.0/suncalc.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    label, input, button { display: block; margin: 10px 0; }
    canvas { background: #f4f4f4; border: 1px solid #ccc; margin-top: 20px; }
  </style>
</head>
<body>
  <h1>Sun Analysis Generator</h1>
  <label for="location">Location Name</label>
  <input id="location" placeholder="Valley Center, CA">

  <label for="latitude">Latitude</label>
  <input id="latitude" type="number" step="any" value="33.2754">

  <label for="longitude">Longitude</label>
  <input id="longitude" type="number" step="any" value="-117.0755">

  <label for="timezone">Time Zone</label>
  <input id="timezone" value="America/Los_Angeles">

  <button onclick="runSunAnalysis()">Generate Report & Visual</button>

  <canvas id="sunCanvas" width="400" height="300"></canvas>

  <script>
    async function runSunAnalysis() {
      const lat = parseFloat(document.getElementById('latitude').value);
      const lon = parseFloat(document.getElementById('longitude').value);
      const locationName = document.getElementById('location').value;
      const timeZone = document.getElementById('timezone').value;
      await generateSunAnalysisReport(lat, lon, locationName, timeZone);
      drawSolarPath(lat, lon);
    }

    async function generateSunAnalysisReport(lat, lon, locationName, timeZone) {
      const dates = [
        { name: "March Equinox", date: new Date("2025-03-20T12:00:00Z") },
        { name: "June Solstice", date: new Date("2025-06-21T12:00:00Z") },
        { name: "September Equinox", date: new Date("2025-09-22T12:00:00Z") },
        { name: "December Solstice", date: new Date("2025-12-21T12:00:00Z") },
      ];

      const results = dates.map(({ name, date }) => {
        const times = SunCalc.getTimes(date, lat, lon);
        const pos = SunCalc.getPosition(times.solarNoon, lat, lon);

        return {
          name,
          dawn: times.dawn.toLocaleTimeString("en-US", { timeZone }),
          sunrise: times.sunrise.toLocaleTimeString("en-US", { timeZone }),
          sunset: times.sunset.toLocaleTimeString("en-US", { timeZone }),
          dusk: times.dusk.toLocaleTimeString("en-US", { timeZone }),
          altitude: (pos.altitude * (180 / Math.PI)).toFixed(2),
          azimuth: (pos.azimuth * (180 / Math.PI) + 180).toFixed(2),
        };
      });

      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();

      doc.setFontSize(14);
      doc.text(`Sun Analysis Report`, 10, 10);
      doc.setFontSize(10);
      doc.text(`Location: ${locationName}`, 10, 16);
      doc.text(`Coordinates: ${lat}, ${lon}`, 10, 21);
      doc.text(`Time Zone: ${timeZone}`, 10, 26);

      let y = 36;
      results.forEach(r => {
        doc.text(`${r.name}`, 10, y);
        y += 6;
        doc.text(`Sunrise: ${r.sunrise}`, 12, y);
        doc.text(`Sunset: ${r.sunset}`, 80, y);
        y += 6;
        doc.text(`Dawn: ${r.dawn}`, 12, y);
        doc.text(`Dusk: ${r.dusk}`, 80, y);
        y += 6;
        doc.text(`Altitude: ${r.altitude}°`, 12, y);
        doc.text(`Azimuth: ${r.azimuth}°`, 80, y);
        y += 10;
      });

      doc.save("sun-analysis-report.pdf");
    }

    function drawSolarPath(lat, lon) {
      const canvas = document.getElementById('sunCanvas');
      const ctx = canvas.getContext('2d');
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      ctx.font = '12px sans-serif';
      ctx.fillText('Solar Path Diagram (Summer & Winter)', 80, 20);

      const centerX = 200;
      const baseY = 250;

      // Simulated summer arc
      ctx.beginPath();
      ctx.arc(centerX, baseY, 100, Math.PI, 0, false);
      ctx.strokeStyle = 'orange';
      ctx.stroke();
      ctx.fillText('Summer', centerX + 105, baseY - 100);

      // Simulated winter arc
      ctx.beginPath();
      ctx.arc(centerX, baseY, 60, Math.PI, 0, false);
      ctx.strokeStyle = 'blue';
      ctx.stroke();
      ctx.fillText('Winter', centerX + 70, baseY - 60);
    }
  </script>
</body>
</html>
